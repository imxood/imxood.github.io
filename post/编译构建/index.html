<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<title> 编译构建 &middot; 分享生活,分享感动 </title>


<link rel="stylesheet" href="http://imxood.github.io/css/slim.css">
<link rel="stylesheet" href="http://imxood.github.io/css/highlight.min.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro' rel='stylesheet' type='text/css'>

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.ico">


<link href="" rel="alternate" type="application/rss+xml" title="分享生活,分享感动" />

</head>

<body>
  <div class="container">
    <div class="header">
  <h1 class="site-title"><a href="http://imxood.github.io/">分享生活,分享感动</a></h1>
  <p class="site-tagline"></p>
  <div class="nav">
    <a class="nav-btn" href="#">
      <span class="ci ci-burger"></span>
    </a>
    <ul class="nav-list">
       
	  <li class="spacer">&ac;</li>
  
    </ul>
  </div>
</div>
    <div class="content">
      <div class="posts">
        <div class="post">
          <h2 class="post-title"><a href="http://imxood.github.io/post/%E7%BC%96%E8%AF%91%E6%9E%84%E5%BB%BA/">编译构建</a></h2>
          <span class="post-date">Feb 20, 2019 </span>
          <div class="post-content">
            

<h1 id="cmake常用语法">cmake常用语法</h1>

<pre><code>include_directories(include)                                            设置头文件路径
link_directories(/usr/lib)                                              设置库路径

add_library(hello1 src/hello.cpp)                                       添加静态库
add_library(hello2 SHARED src/hello.cpp)                                添加动态库
add_executable(sayHello src/useHello.cpp)                               添加可执行程序
target_link_libraries(sayHello hello)                                   链接库

set(CMAKE_BUILD_TYPE Release)                                           设置编译类型, 默认就是Release

set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -std=c++11&quot;)                    设置编译参数

set(CMAKE_CXX_STANDARD 11)

ADD_DEFINITIONS(-DmacroName -DmacroName=macroValue ......)              设置宏

file(GLOB SRC_FILES src/*.c src/*.h)                                    生成一个匹配条件的文件列表

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/exec/)         设置可执行程序的生成目录

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/lib/)          设置动态库的生成目录

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/lib/static/)   设置静态库的生成目录

安装可执行程序或库:
install(
    TARGETS hello1 hello2
    RUNTIME DESTINATION bin
    ARCHIVE DESTINATION lib　#安装静态库到/usr/local/lib目录
    LIBRARY DESTINATION lib　#安装动态库到/usr/local/lib目录
)

install(
    #安装头文件到/usr/local/include目录
    FILES ${PROJECT_SOURCE_DIR}/include/hello.h DESTINATION include
)

install(
    DIRECTORIES ${PROJECT_SOURCE_DIR}/include/utils DESTINATION include
)

执行一个command,生成${TEST_FILE}文件
add_custom_command(OUTPUT  ${TEST_FILE}
    COMMAND echo &quot;Generating log.txt file...&quot;
    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_LIST_FILE} ${TEST_FILE}
    COMMENT  &quot;This is a test&quot;
)
目标Test1,会等待${TEST_FILE}的生成,然后执行
add_custom_target(Test1 ALL DEPENDS ${TEST_FILE})

执行Test1 command
add_custom_command(TARGET Test1
    PRE_BUILD
    COMMAND echo &quot;executing a fake command&quot;
    COMMENT &quot;This command will be executed before building target Test1&quot;
)

搜集所有在指定路径下的源文件的文件名
aux_source_directory(&lt; dir &gt; &lt; variable &gt;)

CMAKE_C_FLAGS 设置C编译选项
CMAKE_CXX_FLAGS 设置C++编译选项


-DCMAKE_INSTALL_RPATH=/usr 编译期与运行期的rpath都会多一条
-DCMAKE_SKIP_RPATH=FALSE 编译期与运行期都不忽略RPATH
</code></pre>

<h3 id="cmake常用的变量">cmake常用的变量</h3>

<pre><code>PROJECT_NAME       项目名称
PROJECT_SOURCE_DIR 工程的根目录
PROJECT_BINARY_DIR 运行cmake命令的目录
CMAKE_INCLUDE_PATH 环境变量,非cmake变量
CMAKE_LIBRARY_PATH 环境变量
CMAKE_CURRENT_SOURCE_DIR 当前处理的CMakeLists.txt所在的路径
CMAKE_SOURCE_DIR cmake配置文件的顶层目录
CMAKE_BINARY_DIR
CMAKE_PREFIX_PATH
CMAKE_FILES_DIRECTORY
CMAKE_INSTALL_PREFIX

cmake_minimum_required(VERSION 2.8)

pkg_check_modules:
    &lt;XPREFIX&gt;_FOUND          ... set to 1 if module(s) exist
    &lt;XPREFIX&gt;_LIBRARIES      ... only the libraries (w/o the '-l')
    &lt;XPREFIX&gt;_LIBRARY_DIRS   ... the paths of the libraries (w/o the '-L')
    &lt;XPREFIX&gt;_LDFLAGS        ... all required linker flags
    &lt;XPREFIX&gt;_LDFLAGS_OTHER  ... all other linker flags
    &lt;XPREFIX&gt;_INCLUDE_DIRS   ... the '-I' preprocessor flags (w/o the '-I')
    &lt;XPREFIX&gt;_CFLAGS         ... all required cflags
    &lt;XPREFIX&gt;_CFLAGS_OTHER   ... the other compiler flags

    &lt;XPREFIX&gt;_LIBDIR
    &lt;XPREFIX&gt;_PREFIX
</code></pre>

<h3 id="对于-usr-local-lib-pkgconfig下的pc文件">对于/usr/local/lib/pkgconfig下的pc文件</h3>

<pre><code>    eg,/usr/local/lib/pkgconfig/audio_process.pc:
        libdir=/usr/local/lib
        includedir=/usr/local/include

        Name: audio_processing
        Description: Webrtc audio process module
        Version: 0.1
        Libs: -L${libdir} -laudio_processing
        Cflags: -DWEBRTC_AUDIO_PROCESSING_ONLY_BUILD -I${includedir}/webrtc -DWEBRTC_POSIX
    libdir,指定了库的路径
    includedir,指定了库的头文件路径
    Libs中的-L指定了${audio_process_LIBRARY_DIRS},-l指定了${audio_process_LIBRARIES}
    Cflags中的-I指定了${audio_process_INCLUDE_DIRS}
    -DWEBRTC_POSIX,表明需要一个WEBRTC_POSIX宏
</code></pre>

<h1 id="catkin">Catkin</h1>

<pre><code>http://docs.ros.org/jade/api/catkin/html/user_guide/variables.html

CATKIN_DEVEL_PATH
CATKIN_INSTALL_PATH
catkin config --install

CATKIN_DEVEL_PREFIX

CATKIN_PACKAGE_***

catkin build --this -j4 -DPEAK_TEST=ON
CMakeLists.txt:
    if (PEAK_TEST)
    else()
    ifend()

使用cmake的install时，默认没有rpath，需要使用CMAKE_INSTALL_RPATH_USE_LINK_PATH启动:
catkin build robot_driver -DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=ON

catkin相关变量:
http://docs.ros.org/jade/api/catkin/html/user_guide/variables.html
</code></pre>

<h1 id="gcc-g">GCC, G++</h1>

<pre><code>-g
只是编译器，在编译的时候，产生调试信息。
-std=c++11
</code></pre>

<h1 id="ninja">ninja</h1>

<h1 id="gn">gn</h1>

<pre><code>http://blog.csdn.net/zhangtracy/article/details/79045363

https://chromium.googlesource.com/chromium/src/+/master/tools/gn/README.md

gn args out --list
gn args out --list=use_custom_libcxx

gn args out/Debug, 打开编译器，添加你需要的编译选项，可覆盖默认配置
也可直接修改out/Debug/args.gn文件
</code></pre>

<h1 id="gdb调试">GDB调试</h1>

<p>应用在目标机上:
gdbserver 192.168.99.10:10000 test_program</p>

<p>主机:
gdb:
show architecture
target remote 192.168.99.10:10000</p>

          </div>
        </div>
        <div class="pagination">
          <a class="btn previous " href="http://imxood.github.io/post/%E7%A1%AC%E4%BB%B6%E8%AE%BE%E8%AE%A1/"> Prev</a>  
          <a class="btn next " href="http://imxood.github.io/post/arm-gcc%E6%B1%87%E7%BC%96/"> Next</a> 
        </div>
      </div>
    </div>
    
    <div class="footer">
  
  <p>Powered by <a href="https://gohugo.io">Hugo</a>. This theme—Slim—is open sourced on <a href="https://github.com/zhe/hugo-theme-slim">Github</a>.</p>
  
</div>

  </div>
  <script src="http://imxood.github.io/js/slim.js"></script>
  <script src="http://imxood.github.io/js/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
</body>

</html>
